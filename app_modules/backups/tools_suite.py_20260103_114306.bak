"""
MODULE: Tools Suite & Clients
VERSION: 1.5.0 (TITANIUM)
DESCRIPTION: Î ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î± Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î¹ÎºÎ¬ ÎµÏÎ³Î±Î»ÎµÎ¯Î± ÎºÎ±Î¹ Ï„Î·Î½ Ï€ÏÎ¿Î²Î¿Î»Î® Ï€ÎµÎ»Î±Ï„Î¿Î»Î¿Î³Î¯Î¿Ï….
             **Î‘Ï…Ï„ÏŒ Ï„Î¿ module Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï€Î»Î­Î¿Î½ Î‘ÎÎ•ÎÎ•Î¡Î“ÎŸ/REDUNDANT, ÎºÎ±Î¸ÏÏ‚ Ï„Î¿ `main.py`
             Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ `modules/ui_tools.py` ÎºÎ±Î¹ `modules/ui_clients.py` Î¾ÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î¬
             Î³Î¹Î± Ï„Î¹Ï‚ Î±Î½Ï„Î¯ÏƒÏ„Î¿Î¹Ï‡ÎµÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚.**
             Î•Î¬Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î¼Î¿Î½Î±Î´Î¹ÎºÎ­Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ ÎµÎ´Ï, Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¼ÎµÏ„Î±Ï†ÎµÏÎ¸Î¿ÏÎ½ ÏƒÏ„Î± `modules/ui_tools.py`
             ÎºÎ±Î¹ `modules/ui_clients.py`.
"""

import streamlit as st
import pandas as pd
from typing import Any

def render_tools_page() -> None:
    """Î•Î¼Ï†Î±Î½Î¯Î¶ÎµÎ¹ Ï„Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î± Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï."""
    st.title("ğŸ§® HVAC Tools Suite")
    
    t1, t2 = st.tabs(["â„ï¸ BTU Calculator", "ğŸ“ Unit Converter"])
    
    with t1:
        st.subheader("Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î¨Ï…ÎºÏ„Î¹ÎºÏÎ½ Î¦Î¿ÏÏ„Î¯Ï‰Î½ (BTU)")
        
        c1, c2 = st.columns(2)
        with c1:
            area = st.number_input("Î•Î¼Î²Î±Î´ÏŒÎ½ Î§ÏÏÎ¿Ï… (mÂ²)", min_value=1.0, value=20.0, step=1.0)
            height = st.number_input("ÎÏˆÎ¿Ï‚ (m)", min_value=2.0, value=3.0, step=0.1)
        with c2:
            insulation = st.selectbox("ÎœÏŒÎ½Ï‰ÏƒÎ·", ["ÎšÎ±Î»Î®", "ÎœÎ­Ï„ÏÎ¹Î±", "ÎšÎ±ÎºÎ®"])
            sun = st.selectbox("ÎˆÎºÎ¸ÎµÏƒÎ· ÏƒÏ„Î¿Î½ Î‰Î»Î¹Î¿", ["Î§Î±Î¼Î·Î»Î®", "ÎœÎ­Ï„ÏÎ¹Î±", "Î¥ÏˆÎ·Î»Î®"])
            
        # Logic
        factor = 500 # Base
        if insulation == "ÎšÎ±Î»Î®": factor -= 50
        if insulation == "ÎšÎ±ÎºÎ®": factor += 100
        if sun == "Î¥ÏˆÎ·Î»Î®": factor += 80
        
        # Volume Correction
        vol_correction = 1.0
        if height > 3.0: vol_correction = height / 3.0
        
        result = area * factor * vol_correction
        
        st.divider()
        st.success(f"ğŸ“Œ Î‘Ï€Î±Î¹Ï„Î¿ÏÎ¼ÎµÎ½Î· Î™ÏƒÏ‡ÏÏ‚: **{int(result):,} BTU/h**")
        st.info("â„¹ï¸ *ÎŸ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ ÎµÎ¼Ï€ÎµÎ¹ÏÎ¹ÎºÏŒÏ‚.*")

    with t2:
        st.write("ğŸ”§ Converter coming soon...")

def render_clients_viewer(data_manager: Any) -> None:
    """
    Î•Î¼Ï†Î±Î½Î¯Î¶ÎµÎ¹ Ï„Î¿ Ï€ÎµÎ»Î±Ï„Î¿Î»ÏŒÎ³Î¹Î¿ Î±Ï€ÏŒ Ï„Î± Google Sheets.
    Args:
        data_manager: ÎœÎ¹Î± ÎºÎ»Î¬ÏƒÎ·/Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î±Ï€ÏŒ Ï„Î¿ main.py Ï€Î¿Ï… Ï†Î­ÏÎ½ÎµÎ¹ Î´ÎµÎ´Î¿Î¼Î­Î½Î±.
    """
    st.title("ğŸ“‡ Î ÎµÎ»Î±Ï„Î¿Î»ÏŒÎ³Î¹Î¿")
    
    # Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
    with st.spinner("Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î ÎµÎ»Î±Ï„ÏÎ½..."):
        # Î¥Ï€Î¿Î¸Î­Ï„Î¿Ï…Î¼Îµ ÏŒÏ„Î¹ Ï„Î¿ DataManager Î­Ï‡ÎµÎ¹ Î¼Î­Î¸Î¿Î´Î¿ fetch_sheet_data
        try:
            df = data_manager.fetch_sheet_data("Clients")
        except Exception as e:
            st.error(f"Error fetching clients: {e}")
            return

    if df.empty:
        st.warning("Î— Î»Î¯ÏƒÏ„Î± Ï€ÎµÎ»Î±Ï„ÏÎ½ ÎµÎ¯Î½Î±Î¹ ÎºÎµÎ½Î®.")
        return

    # Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·
    search = st.text_input("ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î ÎµÎ»Î¬Ï„Î·", placeholder="ÎŒÎ½Î¿Î¼Î±, Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ Î® Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·...")
    
    if search:
        mask = df.astype(str).apply(lambda x: x.str.contains(search, case=False, na=False)).any(axis=1)
        df = df[mask]
        st.success(f"Î’ÏÎ­Î¸Î·ÎºÎ±Î½ {len(df)} ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚.")
        
    st.dataframe(df, use_container_width=True, hide_index=True)